[gd_resource type="Resource" load_steps=2 format=3 uid="uid://bwq2lcpe60tpp"]

[sub_resource type="GDScript" id="GDScript_exf21"]
script/source = "extends Resource


func calculate_consideration_value(npc: NPC, kingdom_state):
	var value = 0
	var npc_knowledge = npc.brain
	# If no enemies, just leave.
	if npc_knowledge.enemies_in_range.size() == 0:
		return -10
		
	for enemy_npc in npc_knowledge.enemies_in_range:
		if enemy_npc is NPC and npc.definition.character_type == \"Hero\":
			# The way we calculate this means that units with a very high bravery essentially won't flee monsters despite low health.	
			if enemy_npc.level > npc.level:
				value -= clamp(5 * ((npc.bravery-npc.personality.cowardice)/100), 0, 100)
			# The way we calculate this means that units with a very high bravery essentially won't flee monsters despite low health.
			if enemy_npc.current_health > npc.current_health:		
				value -= clamp((5 * ((npc.personality.cowardice - npc.personality.bravery)/100)), 0, 100)
			# If an enemy npc is near death, go for the killing blow.
			if enemy_npc.current_health / enemy_npc.max_health < .2:
				value += 10
			# We are thoroughly outclassed by the enemy.
			if npc.attributes.attribute_dict[npc.attributes.primary_stat] < enemy_npc.attributes.attribute_dict[npc.attributes.primary_stat]:
				value -= clamp(10 * ((npc.bravery-npc.personality.cowardice)/100), 0, 100)
			else:
				value += clamp(5 * ((npc.bravery-npc.personality.cowardice)/100), 0, 100)
		else:
			# If an enemy npc is near death, go for the killing blow.
			if enemy_npc.current_health / enemy_npc.max_health < .2:
				value += 10

	
	
	for ally in npc_knowledge.allies_in_range:
		# The way we calculate this means that units with a very high bravery essentially won't flee monsters despite low health.	
		if ally.level > npc.level:
			value += clamp(5 * ((npc.bravery-npc.personality.cowardice)/100), 0, 100)
		else:
			value += clamp(1 * ((npc.bravery-npc.personality.cowardice)/100), 0, 100)
		# The way we calculate this means that units with a very high bravery essentially won't flee monsters despite low health.
		if ally.current_health > npc.current_health:		
			value += clamp((5 * ((npc.personality.cowardice - npc.personality.bravery)/100)), 0, 100)
		else:
			value += clamp((1 * ((npc.personality.cowardice - npc.personality.bravery)/100)), 0, 100)
		# If an ally npc is near death, get spooked.
		if ally.current_health / ally.max_health < .2:
			value -= 5
		
		# If an ally npc is a spellcaster, and we are smart, we should acknowledge the power advantage.
		if ally.definition.name == \"Wizard\" && npc.attributes.intelligence > 15:
			value += 5
		
	return clamp(value, 0, 100)
"

[resource]
script = SubResource("GDScript_exf21")
